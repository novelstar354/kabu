<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚¹ã‚¿ãƒ¼ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ æ ªä¾¡</title>
 <link rel="icon" href="https://thumb.ac-illust.com/20/20e00b51217df4e585ca0c3ef6dcfcd7_w.jpeg" sizes="16Ã—16" type="image/png" />  
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:"Segoe UI",sans-serif;background:#0b1220;color:#fff}
.container{max-width:900px;margin:24px auto;background:#111a2e;border-radius:16px;padding:24px}
h1{text-align:center}
.price{font-size:48px;text-align:center;font-weight:bold}
.diff{text-align:center}
.up{color:#4cff4c}.down{color:#ff5c5c}
.event{text-align:center;font-weight:bold;min-height:24px}

button,input{padding:10px;border-radius:8px;border:none;font-size:15px}
button{cursor:pointer}
.buy{background:#16a34a;color:#fff}
.sell{background:#2563eb;color:#fff}
.toggle{background:#444;color:#fff}
.yarakashi{background:#b91c1c;color:#fff}
.clear{background:#374151;color:#fff}

.grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
.card{background:#0b1220;border-radius:12px;padding:12px}
.card h2{font-size:15px;margin:0 0 6px}

.trade{display:flex;gap:6px;margin-top:6px}
input[type="number"]{background:#020617;color:#fff;width:100%}

.mode{display:flex;gap:10px;font-size:13px;margin-top:6px}
.log{max-height:150px;overflow:auto;font-size:13px}
.log div{border-bottom:1px solid #222;padding:4px 0}
.kv{display:flex;justify-content:space-between;font-size:14px}
.small{font-size:12px;opacity:.7}
canvas{background:#020617;border-radius:12px}
</style>
</head>
<body>

<div class="container">
<h1>ã‚¹ã‚¿ãƒ¼ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h1>

<div class="price" id="price"></div>
<div class="diff" id="diff"></div>
<div class="event" id="event"></div>

<canvas id="chart" width="860" height="260"></canvas>

<div class="trade">
  <button class="toggle" onclick="toggleRandom()">è‡ªå‹•å¤‰å‹• ON/OFF</button>
  <button class="yarakashi" onclick="yarakashi()">ğŸ’¥ ç¤¾é•·ãŒã‚„ã‚‰ã‹ã™</button>
  <button class="clear" onclick="clearSave()">ä¿å­˜å‰Šé™¤</button>
</div>

<div class="grid">
<div class="card">
<h2>ğŸ’¼ ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ª</h2>
<div class="kv"><span>ç¾é‡‘</span><strong id="cash"></strong></div>
<div class="kv"><span>ä¿æœ‰æ ª</span><strong id="shares"></strong></div>
<div class="kv"><span>å¹³å‡å–å¾—</span><strong id="avg"></strong></div>
<div class="kv"><span>è©•ä¾¡æç›Š</span><strong id="unreal"></strong></div>
<div class="kv"><span>å®Ÿç¾æç›Š</span><strong id="realized"></strong></div>

<div class="mode">
  <label><input type="radio" name="mode" value="single" checked> 1æ ª</label>
  <label><input type="radio" name="mode" value="bulk"> ã¾ã¨ã‚</label>
</div>

<input id="qty" type="number" min="1" value="10" disabled>

<div class="trade">
  <button class="buy" onclick="buy()">è²·ã†</button>
  <button class="sell" onclick="sell()">å£²ã‚‹</button>
</div>

<div class="small">â€» æ‰‹æ•°æ–™ Â¥500 / ç´„å®š</div>
</div>

<div class="card">
<h2>ğŸ“‘ ç´„å®šå±¥æ­´</h2>
<div class="log" id="history"></div>
</div>

<div class="card">
<h2>ğŸ“¢ è¨€ã„è¨³(IR)</h2>
<div class="log" id="ir"></div>
</div>

<div class="card">
<h2>ğŸ’¬ æŠ•è³‡å®¶ã‚³ãƒ¡ãƒ³ãƒˆ</h2>
<div class="log" id="comments"></div>
</div>
</div>
</div>

<script>
const FEE=500;

/* ===== çŠ¶æ…‹ ===== */
let price=Number(localStorage.star_price)||4000;
let prev=Number(localStorage.star_prev)||price;
let randomOn=true;

let cash=Number(localStorage.star_cash)||1000000;
let shares=Number(localStorage.star_shares)||0;
let avg=Number(localStorage.star_avg)||0;
let realized=Number(localStorage.star_realized)||0;
let history=JSON.parse(localStorage.star_history||"[]");
let priceHistory=JSON.parse(localStorage.star_chart||"[]");

/* ===== DOM ===== */
const diffEl=document.getElementById("diff");
const eventEl=document.getElementById("event");
const historyEl=document.getElementById("history");
const irEl=document.getElementById("ir");
const commentsEl=document.getElementById("comments");
const qtyInput=document.getElementById("qty");
const chart=document.getElementById("chart");
const ctx=chart.getContext("2d");

document.querySelectorAll('input[name="mode"]').forEach(r=>{
  r.onchange=()=>qtyInput.disabled=r.value==="single";
});

const excuses=["ç²¾æŸ»ä¸­ã§ã™","å½±éŸ¿ã¯è»½å¾®","æƒ³å®šå†…ã§ã™","ä¸€æ™‚çš„ã§ã™"];
const comments=["åŠ©ã‘ã¦","æ¡åŠ›","ã¾ãŸç¤¾é•·","èª¬æ˜ã—ã‚"];

const yen=n=>"Â¥"+Math.round(n).toLocaleString();

/* ===== ä¿å­˜ ===== */
function save(){
 localStorage.star_price=price;
 localStorage.star_prev=prev;
 localStorage.star_cash=cash;
 localStorage.star_shares=shares;
 localStorage.star_avg=avg;
 localStorage.star_realized=realized;
 localStorage.star_history=JSON.stringify(history);
 localStorage.star_chart=JSON.stringify(priceHistory);
}

/* ===== æ›´æ–° ===== */
function update(){
 document.getElementById("price").textContent=yen(price);
 const d=price-prev;
 const p=prev?((d/prev)*100).toFixed(2):"0.00";
 diffEl.textContent=`${d>=0?"+":""}${d} (${p}%)`;
 diffEl.className="diff "+(d>=0?"up":"down");

 document.getElementById("cash").textContent=yen(cash);
 document.getElementById("shares").textContent=shares+"æ ª";
 document.getElementById("avg").textContent=yen(avg);
 document.getElementById("unreal").textContent=yen(shares*(price-avg));
 document.getElementById("realized").textContent=yen(realized);

 historyEl.innerHTML=history.map(h=>`<div>${h}</div>`).join("");

 priceHistory.push(price);
 priceHistory=priceHistory.slice(-120);

 save();
 drawChart();
}

/* ===== å£²è²· ===== */
const getQty=()=>document.querySelector('input[name="mode"]:checked').value==="single"?1:Number(qtyInput.value)||1;

function buy(){
 const q=getQty();
 const cost=price*q+FEE;
 if(cash<cost)return show("è³‡é‡‘ä¸è¶³","down");
 avg=(avg*shares+price*q)/(shares+q);
 shares+=q; cash-=cost;
 log(`è²· ${q}æ ª @${yen(price)}`);
 update();
}

function sell(){
 const q=getQty();
 if(shares<q)return show("æ ªä¸è¶³","down");
 shares-=q; cash+=price*q-FEE;
 realized+=(price-avg)*q-FEE;
 if(!shares)avg=0;
 log(`å£² ${q}æ ª @${yen(price)}`);
 update();
}

function log(t){
 history.unshift(`[${new Date().toLocaleTimeString()}] ${t} æ‰‹æ•°æ–™Â¥500`);
 history=history.slice(0,80);
}

/* ===== ãƒãƒ£ãƒ¼ãƒˆ ===== */
function drawChart(){
 ctx.clearRect(0,0,chart.width,chart.height);
 if(priceHistory.length<2)return;

 const max=Math.max(...priceHistory);
 const min=Math.min(...priceHistory);
 const pad=20;

 ctx.beginPath();
 priceHistory.forEach((p,i)=>{
   const x=pad+i*(chart.width-2*pad)/(priceHistory.length-1);
   const y=chart.height-pad-(p-min)/(max-min||1)*(chart.height-2*pad);
   i?ctx.lineTo(x,y):ctx.moveTo(x,y);
 });
 ctx.strokeStyle="#4cff4c";
 ctx.lineWidth=2;
 ctx.stroke();
}

/* ===== ãã®ä»– ===== */
function show(t,c){
 eventEl.textContent=t;
 eventEl.className="event "+c;
 setTimeout(()=>eventEl.textContent="",1500);
}

function randomMove(){
 if(!randomOn)return;
 prev=price;
 const r=Math.random();
 if(r<0.03){price=Math.floor(price*0.6);ir();com();}
 else if(r<0.06){price=Math.floor(price*1.4);com();}
 else price+=Math.random()*40-20;
 price=Math.max(1,Math.floor(price));
 update();
}

function toggleRandom(){randomOn=!randomOn;show("åˆ‡æ›¿","up");}
function yarakashi(){prev=price;price=Math.floor(price*0.4);ir();com();update();}
const ir=()=>irEl.innerHTML=`<div>${excuses[Math.random()*excuses.length|0]}</div>`+irEl.innerHTML;
const com=()=>commentsEl.innerHTML=`<div>${comments[Math.random()*comments.length|0]}</div>`+commentsEl.innerHTML;

function clearSave(){
 Object.keys(localStorage).filter(k=>k.startsWith("star_")).forEach(k=>localStorage.removeItem(k));
 location.reload();
}

setInterval(randomMove,1500);
update();
</script>
</body>
</html>
